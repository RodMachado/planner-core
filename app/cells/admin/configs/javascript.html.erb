<script type="text/javascript">

ConfigApp = new Backbone.Marionette.Application();

ConfigApp.ConfigManagement = (function(Backbone){

    Equipment = Backbone.Model.extend({
        schema : {
            description     : { type : 'Text', title : '<%= t "equipment-name" %>' }
        },
        urlRoot : '/equipment_types'
    });
    
    EquipmentCollection = Backbone.Collection.extend({
        model : Equipment
    });
    
    ItemFormat = Backbone.Model.extend({
        schema : {
            name     : { type : 'Text', title : '<%= t "format-name" %>' },
            positon  : { type : 'Number', title : '<%= t "format-position" %>' }
            // TODO - position???
        },
        urlRoot : '/formats'
    });
    
    ItemFormatCollection = Backbone.Collection.extend({
        model : ItemFormat
    });
    
    
    ConfigLayout = Backbone.Marionette.Layout.extend({
        template: "#config-list-layout-template",
        
        regions : {
            controlRegion   : "#config-control-div",
            configRegion    : "#config-region-div",
        },
    });

    var configRegion = new Backbone.Marionette.Region({
        el: "#config-area"
    });


    var tabLists = [];
    
    function clearDetails() {
        _.invoke(tabLists, 'reset' );
    };

    var Workspace = Backbone.Router.extend({
        routes : {
            'equipment_config' : 'equipment_config',
            'item_format_config' : 'item_format_config',
            'invitation_category_config' : 'invitation_category_config',
            'room_setups_config' : 'room_setups_config',
            'conference_config' : 'conference_config',
            'email_config' : 'email_config'
        },
        
        equipment_config : function() {
            configRegion.close();
            
            equipmentLayout = new ConfigLayout();
            configRegion.show(equipmentLayout);
            
            TabUtils.createTabControl({
                template                : "#equipment-control-template",
                modelType               : Equipment,
                view_refresh_event      : "equipment:refresh",
                modal_create_title      : '<%= t "create-equipment" %>',
                region                  : equipmentLayout.controlRegion,
            });
            
            tabLists.push( AppUtils.createCollectionView({
                url                     : "/equipment_types.json",
                collectionType          : EquipmentCollection,
                region                  : equipmentLayout.configRegion,
                template                : "#equipment-template",
                collection_attributes   : { "class" : "table table-striped table-condensed" },
                collection_tagName      : 'table',
                tagName                 : 'tr',
                view_refresh_event      : "equipment:refresh",
                modal_edit_title        : '<%= t "edit-equipment" %>',
                modal_edit              : true
            }) );
        },
        
        item_format_config : function() {
            configRegion.close();
            
            itemFormatLayout = new ConfigLayout();
            configRegion.show(itemFormatLayout);
            
            TabUtils.createTabControl({
                template                : "#item-format-control-template",
                modelType               : ItemFormat,
                view_refresh_event      : "item_format:refresh",
                modal_create_title      : '<%= t "create-item-format" %>',
                region                  : itemFormatLayout.controlRegion,
            });
            
            tabLists.push( AppUtils.createCollectionView({
                url                     : "/formats.json",
                collectionType          : ItemFormatCollection,
                region                  : itemFormatLayout.configRegion,
                template                : "#item-format-template",
                collection_attributes   : { "class" : "table table-striped table-condensed" },
                collection_tagName      : 'table',
                tagName                 : 'tr',
                view_refresh_event      : "item_format:refresh",
                modal_edit_title        : '<%= t "edit-item-format" %>',
                modal_edit              : true
            }) );
        },
        
        invitation_category_config : function() {
            configRegion.close();
        },
        
        room_setups_config : function() {
            configRegion.close();
        },
        
        conference_config : function() {
            configRegion.close();
        },
        
        email_config : function() {
            configRegion.close();
        }
    });

    /*
     * 
     */
    return {
        init : function(options) {
            new Workspace();
            Backbone.history.start();
        }
    }
    
})(Backbone);

/*
 * 
 */
jQuery(document).ready(function() {
    ConfigApp.addInitializer(ConfigApp.ConfigManagement.init);
    ConfigApp.start({});
});

</script>
