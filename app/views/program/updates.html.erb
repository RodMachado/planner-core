<h1>Convention Guide Corrections</h1>
<!--
<% @resultantChanges.each do |key, val| %>
    <%= key %><br/>
    <% if val.kind_of?(PublishedProgrammeItem) %>
        <%= val.title %>
    <% else %>
        <% val.each do |k,v| %>
            <% if k.kind_of?(PublishedProgrammeItem) %>
                <%= k.title %>
            <% else %>
                <%= k %>
            <% end %>
            <%= v %><br/>
        <% end %>
    <% end %>
<% end %>
-->

<% changedItems = @resultantChanges[:update] %>
<% if changedItems %>
<h2>Item Time and Room Changes</h2>
<% changedItems.each do |k, v| %>
    <%= k.title %></br>
    <% if v.size > 0 %>
    <% if v[:timeMove]%>
    Schedule Change: 
    <%= v[:timeMove][0].getlocal().strftime("%A at %H:%M") %> has changed to
    <%= v[:timeMove][1].getlocal().strftime("%A at %H:%M") %>
    <% else %>
    <%= k.published_time_slot.start.getlocal().strftime("%A at %H:%M") %>
    <% end%>
    <% if v[:roomMove] && v[:roomMove].kind_of?(Array) && v[:roomMove].size > 1 %>
    The room change: 
    <%= v[:roomMove][1].name %> to
    <%= v[:roomMove][0].name %>
    <% end%>
    <% end %>
<% end %>
<% end %>

<% addedItems = @resultantChanges[:new] %>
<% if addedItems %>
<h2>New Items Added to Program</h2>
<% addedItems.each do |k, v| %>
    <%= k.title %></br>
    <%= v[0].getlocal().strftime("%A at %H:%M") %> in <%= k.published_room.published_venue.name %>( <%= k.published_room.name %> ) <br/>
    <%= k.precis %></br>
<% end %>
<% end %>

<% droppedItems = @resultantChanges[:removeItem] %>
<% if droppedItems %>
<h2>Dropped Items</h2>
<% droppedItems.each do |k, v| %>
    <!-- TODO: Add the program number, also add the venue -->
    <%= v[:title] %></br>
    dropped from <%= v[:info][1].getlocal().strftime("%A at %H:%M") %>
    in <%= v[:info][0].published_venue.name %>( <%= v[:info][0].name %> )<br/>
<% end %>
<% end %>

<% peopleAdded = @resultantChanges[:addPerson] %>
<% if peopleAdded %>
<h2>Program Participants Added to Programme Items</h2>
<% peopleAdded.each do |k, v| %>
    <%= k.title %></br>
    <%= k.published_time_slot.start.getlocal().strftime("%A at %H:%M") %><br/>
    <% v.each_index do |idx| %>
        <% if idx % 2 == 0 %>
        <%= v[idx].GetFullPublicationName %> as <%= v[idx +1].name %> <br/>
        <% end %>
    <% end %>
<% end %>
<% end %>

<% peopleRemoved = @resultantChanges[:removePerson] %>
<% if peopleRemoved %>
<h2>Program Participants Dropped from Particular  Programme Items</h2>
<% peopleRemoved.each do |k, v| %>
    <%= k.title %></br>
    <%= k.published_time_slot.start.getlocal().strftime("%A at %H:%M") %><br/>
    <% v.each_index do |idx| %>
        <% if idx % 2 == 0 %>
        <%= v[idx].GetFullPublicationName %><br/>
        <% end %>
    <% end %>
<% end %>
<% end %>

<% updatedItemDetails = @resultantChanges[:updateDetails] %>
<% if updatedItemDetails %>
<h2>Title and Description Changes</h2>
<% updatedItemDetails.each do |k, v| %>
    <%= k.title %></br>
    <% if v.size > 0 %>
    <% if v.kind_of?(Array) %>
        <% v.each do |change| %>
            <% change.each do |name, vals| %>
                <%=name %> changed to: 
                <%= vals[1] %>
            <% end %>
        <% end %>
    <% end%>
    <% end %>
<% end %>
<% end %>
